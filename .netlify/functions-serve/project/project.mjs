
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// functions/database/connection.js
import { MongoClient, ServerApiVersion } from "mongodb";
var uri = process.env.ATLAS_URI || "";
var cachedClient = null;
var client = new MongoClient(uri, {
  //serverAPI object uses MongoDB driver configuration to use the Server API for specific MongoDB versions compatibility.
  serverAPI: {
    version: ServerApiVersion.v1,
    // version 1 of the MongoDB Server API for compatibility.
    strict: true,
    //  MongoDB driver throws error for Server API version unsupported methods-features.
    deprecationErrors: true
    // MongoDB driver throws error for Server API version deprecated methods-features.
  }
});
async function getDatabase() {
  try {
    await client.connect();
    if (!cachedClient) {
      cachedClient = client;
      console.log("MongoDB connection established sucessfully");
    }
    return cachedClient.db("projects");
  } catch (error) {
    console.error(error);
  }
}
var projects_db = await getDatabase();
var connection_default = projects_db;

// functions/project.mjs
import { ObjectId } from "mongodb";
async function handler(event, context) {
  const { method, path, query, body: body2 } = event;
  const id = path.split("/").pop();
  const headers2 = {
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Methods": "GET, POST, PATCH, DELETE, OPTIONS",
    "Access-Control-Allow-Headers": "Content-Type"
  };
  if (method === "OPTIONS") {
    return {
      statusCode: 200,
      headers: headers2
    };
  }
  try {
    if (method === "GET" && path === "/") {
      return await getProjects();
    }
    if (method === "GET" && path === "/project/") {
      return await getProject(id);
    }
    if (method === "POST") {
      return await createProject(body2);
    }
    if (method === "PATCH") {
      return await updateProject(id, body2);
    }
    if (method === "DELETE") {
      return await deleteProject(id);
    }
    return { statusCode: 405, headers: headers2, body: `Method ${method} Not Allowed` };
  } catch (error) {
    console.error("Error:", error);
    return {
      statusCode: 500,
      headers: headers2,
      body: "server error occured"
    };
  }
}
var CreateProject = class {
  constructor(request) {
    const reqbody = request.body;
    this.name = reqbody.name;
    this.category = reqbody.category;
    this.description = reqbody.description;
    this.tech_stack = reqbody.tech_stack;
    this.repository = reqbody.repository;
    this.url = reqbody.url;
    this.image = reqbody.image;
  }
};
async function getProjects() {
  const collection = await connection_default.collection("projects");
  const projects = await collection.find({}).toArray();
  return {
    statusCode: 200,
    headers,
    body: JSON.stringify(projects)
  };
}
async function getProject(project_id) {
  const collection = await connection_default.collection("projects");
  const query = { _id: new ObjectId(project_id) };
  const project = await collection.findOne(query);
  if (!project) {
    return { statusCode: 404, headers, body: "Project not found" };
  }
  return { statusCode: 200, headers, body: JSON.stringify(project) };
}
async function createProject(body2) {
  try {
    const reqbody = JSON.parse(body2);
    const newProject = new CreateProject(reqbody);
    const collection = await db.collection("projects");
    const project = await collection.insertOne(newProject);
    return {
      statusCode: 204,
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
      },
      body: JSON.stringify(project)
    };
  } catch (error) {
    console.error("Error adding new project:", error);
    return {
      statusCode: 500,
      // Internal Server Error
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
      },
      body: JSON.stringify({ message: "Error adding new project" })
    };
  }
}
async function updateProject(project_id, body2) {
  const collection = await connection_default.collection("projects");
  const reqbody = JSON.parse(body2);
  const query = { _id: new ObjectId(project_id) };
  const newProject = new CreateProject(reqbody);
  const projectUpdates = { $set: newProject };
  const project = await collection.updateOne(query, projectUpdates);
  if (project.matchedCount === 0) {
    return {
      statusCode: 404,
      headers,
      body: `Project with ${project_id} dooesn't exist`
    };
  }
  return { statusCode: 200, headers, body: JSON.stringify(project) };
}
async function deleteProject(project_id) {
  const collection = await connection_default.collection("projects");
  const reqbody = JSON.parse(body);
  const query = { _id: new ObjectId(project_id) };
  const project = await collection.deleteOne(query);
  if (project.deletedCount === 0) {
    return {
      statusCode: 404,
      headers,
      body: `Project with ${project_id} dooesn't exist`
    };
  }
  return { statusCode: 200, headers, body: JSON.stringify(project) };
}
var project_default = router;
export {
  project_default as default,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiZnVuY3Rpb25zL2RhdGFiYXNlL2Nvbm5lY3Rpb24uanMiLCAiZnVuY3Rpb25zL3Byb2plY3QubWpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBNb25nb0NsaWVudCwgU2VydmVyQXBpVmVyc2lvbiB9IGZyb20gXCJtb25nb2RiXCI7IC8vIGltcG9ydCAgTW9uZ29DbGllbnQgYW5kIFNlcnZlckFwaVZlcnNpb24gY2xhc3NlcyBmcm9tIG1vbmdvZGJcclxuY29uc3QgdXJpID0gcHJvY2Vzcy5lbnYuQVRMQVNfVVJJIHx8IFwiXCI7IC8vIGdldCBBdGxhcyBVUkkgZnJvbSBlbnYgZmlsZVxyXG5cclxuLypcclxuY3JlYXRlIGEgdmFyaWFibGUgdGhhdCBzdG9yZXMgdGhlIE1vbmdvREIgY2xpZW50IGluc3RhbmNlIGFmdGVyIGl0IGNvbm5lY3RzIHRvIHRoZSBkYXRhYmFzZVxyXG5pbiBTZXJ2ZXJsZXNzIGZ1bmN0aW9uYWxpdHkgZXZlcnkgZnVuY3Rpb24gY2FsbCBjcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBmdW5jdGlvbi4gXHJcbk5vIGNhY2hpbmcgTW9uZ29EQiBjbGllbnQgLT4gbmV3IE1vbmdvREIgY29ubmVjdGlvbiBlc3RhYmxpc2hlZCBmb3IgZWFjaCByZXF1ZXN0XHJcbi0gaW5jcmVhc2VkIExhdGVuY3lcclxuLSBwYXJhbGxlbCBvcGVuZWQgbXVsdGlwbGUgY29ubmVjdGlvbnMgZmlsbCBkYXRhYmFzZSdzIGNvbm5lY3Rpb24gcG9vbC5cclxuQ2FjaGluZyBNb25nb0RCIGNsaWVudFxyXG5JZiB0aGUgY2xpZW50IGhhcyBhbHJlYWR5IGJlZW4gY3JlYXRlZCAtPiByZWFkeSB0byBiZSByZXVzZWQuXHJcbklmIHRoZSBjbGllbnQgaXMgbnVsbCAtPiAgY3JlYXRlIGEgbmV3IGNvbm5lY3Rpb24gYW5kIGFzc2lnbiBpdCB0byBjYWNoZWQgY2xpZW50IHZhcmlhYmxlLlxyXG5cclxuaHR0cHM6Ly93d3cubW9uZ29kYi5jb20vYmxvZy9wb3N0L29wdGltaXppbmctYXdzLWxhbWJkYS1wZXJmb3JtYW5jZS13aXRoLW1vbmdvZGItYXRsYXMtYW5kLW5vZGVqc1xyXG5odHRwczovL2FraGlsYWFyaXlhY2hhbmRyYS5jb20vYmxvZy91c2luZy1tb25nb2RiLWluLWEtc2VydmVybGVzcy1hcHBcclxuaHR0cHM6Ly9tZWRpdW0uY29tL0BqZ2NtYXJpbnMvbm9kZS1qcy1zZXJ2ZXJsZXNzLWF3cy1sYW1iZGEtZnVuY3Rpb24taG93LXRvLWNhY2hlLW1vbmdvZGItY29ubmVjdGlvbi1hbmQtcmV1c2UtaXQtYmV0d2Vlbi02ZWMyZmVhMGY0NjVcclxuXHJcbiovXHJcbmxldCBjYWNoZWRDbGllbnQgPSBudWxsOyAvLyBmb3Igc2VydmVybGVzcyAtIGNvbW1lbnQgaWYgbm90XHJcblxyXG4vLyBjcmVhdGUgY2xpZW50IGluc3RhbmNlIHVzaW5nIG5ldyBNb25nb0NsaWVudCBjb25zdHJ1Y3RvclxyXG5jb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCB7XHJcbiAgLy9zZXJ2ZXJBUEkgb2JqZWN0IHVzZXMgTW9uZ29EQiBkcml2ZXIgY29uZmlndXJhdGlvbiB0byB1c2UgdGhlIFNlcnZlciBBUEkgZm9yIHNwZWNpZmljIE1vbmdvREIgdmVyc2lvbnMgY29tcGF0aWJpbGl0eS5cclxuICBzZXJ2ZXJBUEk6IHtcclxuICAgIHZlcnNpb246IFNlcnZlckFwaVZlcnNpb24udjEsIC8vIHZlcnNpb24gMSBvZiB0aGUgTW9uZ29EQiBTZXJ2ZXIgQVBJIGZvciBjb21wYXRpYmlsaXR5LlxyXG4gICAgc3RyaWN0OiB0cnVlLCAvLyAgTW9uZ29EQiBkcml2ZXIgdGhyb3dzIGVycm9yIGZvciBTZXJ2ZXIgQVBJIHZlcnNpb24gdW5zdXBwb3J0ZWQgbWV0aG9kcy1mZWF0dXJlcy5cclxuICAgIGRlcHJlY2F0aW9uRXJyb3JzOiB0cnVlLCAvLyBNb25nb0RCIGRyaXZlciB0aHJvd3MgZXJyb3IgZm9yIFNlcnZlciBBUEkgdmVyc2lvbiBkZXByZWNhdGVkIG1ldGhvZHMtZmVhdHVyZXMuXHJcbiAgfSxcclxufSk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXREYXRhYmFzZSgpIHtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTsgLy8gd2FpdCB0byBDb25uZWN0IHRvIHRoZSBkYXRhYmFzZS5cclxuICAgIC8vIGlmIHNlcnZlcmxlc3NcclxuICAgIC8vIENoZWNrIGlmIGNhY2hlZCBjbGllbnQgZXhpc3QuXHJcbiAgICBpZiAoIWNhY2hlZENsaWVudCkge1xyXG4gICAgICBjYWNoZWRDbGllbnQgPSBjbGllbnQ7IC8vIFN0b3JlIHRoZSBjb25uZWN0ZWQgY2xpZW50IGluIHRoZSBjYWNoZS5cclxuICAgICAgY29uc29sZS5sb2coXCJNb25nb0RCIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQgc3VjZXNzZnVsbHlcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2FjaGVkQ2xpZW50LmRiKFwicHJvamVjdHNcIik7IC8vIFJldHVybiB0aGUgZGF0YWJhc2UgaW5zdGFuY2UgZnJvbSB0aGUgY2FjaGVkIGNsaWVudC5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7IC8vIGNvbnNvbGUgbG9nIGVycm9yXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBwcm9qZWN0c19kYiA9IGF3YWl0IGdldERhdGFiYXNlKCk7IC8vIGdldCBwcm9qZWN0cyBkYXRhYmFzZVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcHJvamVjdHNfZGI7IC8vIGV4cG9ydCBwcm9qZWN0cyBkYXRhYmFzZVxyXG4iLCAiaW1wb3J0IHByb2plY3RzX2RiIGZyb20gXCIuL2RhdGFiYXNlL2Nvbm5lY3Rpb24uanNcIjsgLy8gaW1wb3J0IHByb2plY3RzIGRhdGFiYXNlIGZyb20gY29ubmVjdGlvblxyXG5cclxuaW1wb3J0IHsgT2JqZWN0SWQgfSBmcm9tIFwibW9uZ29kYlwiOyAvLyBpbXBvcnQgT2JqZWN0SWQgbWV0aG9kIHRvIGNvbnZlcnQgdGhlIF9pZCBmaWVsZCB2YWx1ZSB0byBzdHJpbmcgWyBodHRwczovL3d3dy5tb25nb2RiLmNvbS9kb2NzL21hbnVhbC9yZWZlcmVuY2UvbWV0aG9kL09iamVjdElkLyBdXHJcblxyXG4vKlxyXG5odHRwczovL3d3dy5uZXRsaWZ5LmNvbS9ibG9nL2ludHJvLXRvLXNlcnZlcmxlc3MtZnVuY3Rpb25zL1xyXG5cclxuVGhlIGZ1bmN0aW9uIGhhbmRsZXIgcmVjZWl2ZXMgSFRUUCByZXF1ZXN0IGRhdGEgdGhyb3VnaCBldmVudC5cclxuSXQgcHJvY2Vzc2VzIHRoZSByZXF1ZXN0IHVzaW5nIHRoZSBodHRwTWV0aG9kIHRvIGRldGVybWluZSB0aGUgdHlwZSBvZiBvcGVyYXRpb24gKEdFVCwgUE9TVCwgZXRjLikuXHJcbkJhc2VkIG9uIHRoZSByZXF1ZXN0IHBhdGgsIGl0IGludGVyYWN0cyB3aXRoIGEgTW9uZ29EQiBjb2xsZWN0aW9uIChwcm9qZWN0c19kYi5jb2xsZWN0aW9uKFwicHJvamVjdHNcIikpIHRvOlxyXG5SZXRyaWV2ZSBhbGwgcHJvamVjdHMgb3IgYSBzaW5nbGUgcHJvamVjdCBieSBJRCAoR0VUKS5cclxuSW5zZXJ0IGEgbmV3IHByb2plY3QgKFBPU1QpLlxyXG5JdCByZXR1cm5zIGEgcmVzcG9uc2Ugb2JqZWN0IGNvbnRhaW5pbmcgYW4gYXBwcm9wcmlhdGUgc3RhdHVzQ29kZSwgaGVhZGVycywgYW5kIGJvZHkuXHJcbldoZW4gSXRcdTIwMTlzIEludm9rZWRcclxuVGhlIHNlcnZlcmxlc3MgcGxhdGZvcm0gYXV0b21hdGljYWxseSBpbnZva2VzIHRoZSBoYW5kbGVyIGZ1bmN0aW9uIHdoZW5ldmVyIHRoZSBjb3JyZXNwb25kaW5nIEFQSSByb3V0ZSBpcyBhY2Nlc3NlZCBieSBhbiBIVFRQIHJlcXVlc3QuIEZvciBleGFtcGxlOlxyXG5cclxuQSBHRVQgcmVxdWVzdCB0byAvYXBpL3Byb2plY3QvMTIzIGNhbGxzIGhhbmRsZXIgd2l0aCB0aGUgZXZlbnQgY29udGFpbmluZyB0aGUgcGF0aCAvcHJvamVjdC8xMjMuXHJcbkEgUE9TVCByZXF1ZXN0IHRvIC9hcGkvcHJvamVjdCB3aXRoIGEgYm9keSBwYXlsb2FkIHRyaWdnZXJzIHRoZSBQT1NUIGxvZ2ljIHdpdGhpbiBoYW5kbGVyLlxyXG5cclxuXHJcblNlcnZlcmxlc3MgZnVuY3Rpb24gaGFuZGxlciBbIGh0dHBzOi8vZG9jcy5kaWdpdGFsb2NlYW4uY29tL3Byb2R1Y3RzL2Z1bmN0aW9ucy9yZWZlcmVuY2UvcnVudGltZXMvbm9kZS1qcy8gXVxyXG5UaGUgaGFuZGxlciBmdW5jdGlvbiBwYXNzZXMgdHdvIHBhcmFtZXRlcnMsIGV2ZW50IGFuZCBjb250ZXh0LlxyXG5ldmVudCAtPiBpbnB1dCBldmVudCBpbml0aWF0aW5nIHRoZSBmdW5jdGlvbi4gSFRUUCBldmVudCAtPiB3ZWIgZXZlbnQuXHJcbmNvbnRleHQgLT4gIGZ1bmN0aW9uXHUyMDE5cyBleGVjdXRpb24gZW52aXJvbm1lbnQgZGF0YSh0aW1lb3V0LCBtZW1vcnkpXHJcblxyXG4qL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihldmVudCwgY29udGV4dCkge1xyXG4gIGNvbnN0IHsgbWV0aG9kLCBwYXRoLCBxdWVyeSwgYm9keSB9ID0gZXZlbnQ7IC8vIGRlc3RydWN0dXJpbmcgZXZlbnQgb2JqZWN0XHJcbiAgY29uc3QgaWQgPSBwYXRoLnNwbGl0KFwiL1wiKS5wb3AoKTsgLy8gZ2V0IGlkIGZyb20gdGhlIHBhdGhcclxuICAvKlxyXG4gICBjb25zdCBtZXRob2QgPSBldmVudC5tZXRob2Q7XHJcbiAgIGNvbnN0IHBhdGggPSBldmVudC5wYXRoO1xyXG4gICBjb25zdCBxdWVyeSA9IGV2ZW50LnF1ZXJ5O1xyXG4gICBjb25zdCBib2R5ID0gZXZlbnQuYm9keTtcclxuICAqL1xyXG5cclxuICAvLyBzZXQgaGVhZGVycyBmb3IgdGhlIHJlc3BvbnNlXHJcbiAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiKlwiLFxyXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzXCI6IFwiR0VULCBQT1NULCBQQVRDSCwgREVMRVRFLCBPUFRJT05TXCIsXHJcbiAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCJDb250ZW50LVR5cGVcIixcclxuICB9O1xyXG5cclxuICAvLyBpZiBtZXRob2QgaXMgb3B0aW9ucyByZXR1cm4gc3RhdHVzIG9rIGFuZCB0aGUgaGVhZGVycyBbIGh0dHBzOi8vZnJlZWRpdW0uY2ZkL2h0dHBzOi8vbWVkaXVtLmNvbS9AYXJzaDEyMDcvd2hhdC1hcmUtaHR0cC1vcHRpb25zLW1ldGhvZHMtMmRjNzM2MTVlY2FkIF1cclxuICBpZiAobWV0aG9kID09PSBcIk9QVElPTlNcIikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzQ29kZTogMjAwLFxyXG4gICAgICBoZWFkZXJzLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBpZiAobWV0aG9kID09PSBcIkdFVFwiICYmIHBhdGggPT09IFwiL1wiKSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCBnZXRQcm9qZWN0cygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXRob2QgPT09IFwiR0VUXCIgJiYgcGF0aCA9PT0gXCIvcHJvamVjdC9cIikge1xyXG4gICAgICByZXR1cm4gYXdhaXQgZ2V0UHJvamVjdChpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1ldGhvZCA9PT0gXCJQT1NUXCIpIHtcclxuICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZVByb2plY3QoYm9keSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1ldGhvZCA9PT0gXCJQQVRDSFwiKSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB1cGRhdGVQcm9qZWN0KGlkLCBib2R5KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWV0aG9kID09PSBcIkRFTEVURVwiKSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCBkZWxldGVQcm9qZWN0KGlkKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiB0aGUgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWRcclxuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDQwNSwgaGVhZGVycywgYm9keTogYE1ldGhvZCAke21ldGhvZH0gTm90IEFsbG93ZWRgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzQ29kZTogNTAwLFxyXG4gICAgICBoZWFkZXJzLFxyXG4gICAgICBib2R5OiBcInNlcnZlciBlcnJvciBvY2N1cmVkXCIsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLy8gKioqKioqKioqKiBBcHBsaWNhdGlvbiByb3V0ZXMgKioqKioqKioqKlxyXG4vLyBbIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvTGVhcm5fd2ViX2RldmVsb3BtZW50L0V4dGVuc2lvbnMvU2VydmVyLXNpZGUvRXhwcmVzc19Ob2RlanMvcm91dGVzIF1cclxuXHJcbi8vICMjIyMjIyMjIEdldCBhbGwgcHJvamVjdHMgIyMjIyMjIyNcclxuXHJcbi8vIGlmIHNlcnZlcmxlc3NcclxuXHJcbi8vIENyZWF0ZVByb2plY3QgY2xhc3NcclxuY2xhc3MgQ3JlYXRlUHJvamVjdCB7XHJcbiAgY29uc3RydWN0b3IocmVxdWVzdCkge1xyXG4gICAgY29uc3QgcmVxYm9keSA9IHJlcXVlc3QuYm9keTsgLy8gZWFzaWVyIGFjY2VzcyB0byByZXF1ZXN0LmJvZHlcclxuICAgIHRoaXMubmFtZSA9IHJlcWJvZHkubmFtZTtcclxuICAgIHRoaXMuY2F0ZWdvcnkgPSByZXFib2R5LmNhdGVnb3J5O1xyXG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHJlcWJvZHkuZGVzY3JpcHRpb247XHJcbiAgICB0aGlzLnRlY2hfc3RhY2sgPSByZXFib2R5LnRlY2hfc3RhY2s7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkgPSByZXFib2R5LnJlcG9zaXRvcnk7XHJcbiAgICB0aGlzLnVybCA9IHJlcWJvZHkudXJsO1xyXG4gICAgdGhpcy5pbWFnZSA9IHJlcWJvZHkuaW1hZ2U7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBHRVQgcmVxdWVzdCBoYW5kbGVyIGZvciBhbGwgcHJvamVjdHNcclxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvamVjdHMoKSB7XHJcbiAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IHByb2plY3RzX2RiLmNvbGxlY3Rpb24oXCJwcm9qZWN0c1wiKTtcclxuICBjb25zdCBwcm9qZWN0cyA9IGF3YWl0IGNvbGxlY3Rpb24uZmluZCh7fSkudG9BcnJheSgpO1xyXG4gIHJldHVybiB7XHJcbiAgICBzdGF0dXNDb2RlOiAyMDAsXHJcbiAgICBoZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkocHJvamVjdHMpLFxyXG4gIH07XHJcbn1cclxuXHJcbi8vIEdFVCByZXF1ZXN0IGhhbmRsZXIgZm9yIHByb2plY3Qgd2l0aCBpZFxyXG5hc3luYyBmdW5jdGlvbiBnZXRQcm9qZWN0KHByb2plY3RfaWQpIHtcclxuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgcHJvamVjdHNfZGIuY29sbGVjdGlvbihcInByb2plY3RzXCIpO1xyXG4gIGNvbnN0IHF1ZXJ5ID0geyBfaWQ6IG5ldyBPYmplY3RJZChwcm9qZWN0X2lkKSB9OyAvLyBzZXQgbmV3IHF1ZXJ5IG9iamVjdCBpZCBiYXNlZCBvbiBlbnRyeSBpbiB0aGUgZGF0YWJhc2UgaGF2aW5nIHRoZSBfaWQgZmllbGRcclxuICAvKiBbIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9tZXRob2QvZGIuY29sbGVjdGlvbi5maW5kT25lLyBdXHJcbiAgICBmaW5kT25lKHF1ZXJ5KSBsb29rcyBmb3IgYSBzaW5nbGUgZG9jdW1lbnQgaW4gdGhlIGNvbGxlY3Rpb24gdGhhdCBtYXRjaGVzIHRoZSBjcml0ZXJpYSBpbiBxdWVyeSAoX2lkKS5cclxuICAgKi9cclxuICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgY29sbGVjdGlvbi5maW5kT25lKHF1ZXJ5KTtcclxuXHJcbiAgaWYgKCFwcm9qZWN0KSB7XHJcbiAgICByZXR1cm4geyBzdGF0dXNDb2RlOiA0MDQsIGhlYWRlcnMsIGJvZHk6IFwiUHJvamVjdCBub3QgZm91bmRcIiB9O1xyXG4gIH1cclxuICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGhlYWRlcnMsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHByb2plY3QpIH07XHJcbn1cclxuXHJcbi8vIFBPU1QgcmVxdWVzdCBoYW5kbGVyIHRvIGNyZWF0ZSBwcm9qZWN0XHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVByb2plY3QoYm9keSkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBQYXJzZSB0aGUgYm9keSBhbmQgaW5zdGFudGlhdGUgQ3JlYXRlUHJvamVjdFxyXG4gICAgY29uc3QgcmVxYm9keSA9IEpTT04ucGFyc2UoYm9keSk7IC8vIFBhcnNlIEpTT04gc3RyaW5nIGludG8gYW4gb2JqZWN0XHJcbiAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IENyZWF0ZVByb2plY3QocmVxYm9keSk7IC8vIHVzZSBDcmVhdGVQcm9qZWN0IGNsYXNzIHRvIGNyZWF0ZSBuZXcgb2JqZWN0XHJcblxyXG4gICAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJwcm9qZWN0c1wiKTtcclxuXHJcbiAgICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgY29sbGVjdGlvbi5pbnNlcnRPbmUobmV3UHJvamVjdCk7XHJcblxyXG4gICAgLy8gUmV0dXJuIHN1Y2Nlc3MgcmVzcG9uc2VcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXR1c0NvZGU6IDIwNCxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiKlwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwcm9qZWN0KSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgbmV3IHByb2plY3Q6XCIsIGVycm9yKTtcclxuXHJcbiAgICAvLyBSZXR1cm4gZXJyb3IgcmVzcG9uc2VcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXR1c0NvZGU6IDUwMCwgLy8gSW50ZXJuYWwgU2VydmVyIEVycm9yXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIipcIixcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkVycm9yIGFkZGluZyBuZXcgcHJvamVjdFwiIH0pLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFBBVENIIHJlcXVlc3QgaGFuZGxlciBmb3IgcHJvamVjdCB3aXRoIGlkXHJcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb2plY3QocHJvamVjdF9pZCwgYm9keSkge1xyXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBwcm9qZWN0c19kYi5jb2xsZWN0aW9uKFwicHJvamVjdHNcIik7XHJcbiAgY29uc3QgcmVxYm9keSA9IEpTT04ucGFyc2UoYm9keSk7IC8vIFBhcnNlIEpTT04gc3RyaW5nIGludG8gYW4gb2JqZWN0XHJcblxyXG4gIGNvbnN0IHF1ZXJ5ID0geyBfaWQ6IG5ldyBPYmplY3RJZChwcm9qZWN0X2lkKSB9O1xyXG4gIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgQ3JlYXRlUHJvamVjdChyZXFib2R5KTtcclxuICBjb25zdCBwcm9qZWN0VXBkYXRlcyA9IHsgJHNldDogbmV3UHJvamVjdCB9O1xyXG4gIGNvbnN0IHByb2plY3QgPSBhd2FpdCBjb2xsZWN0aW9uLnVwZGF0ZU9uZShxdWVyeSwgcHJvamVjdFVwZGF0ZXMpO1xyXG5cclxuICAvLyBtYXRjaGVkQ291bnQgPSAwIC0+IGNoZWNrIGlmIHRoZSBwcm9qZWN0IHdpdGggdGhlIHNwZWNpZmllZCBfaWQgZG9lc250IGV4aXN0IGluIHRoZSBkYXRhYmFzZSBbIGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL2RvY3MvbWFudWFsL3JlZmVyZW5jZS9tZXRob2QvZGIuY29sbGVjdGlvbi51cGRhdGVPbmUvXVxyXG4gIGlmIChwcm9qZWN0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxyXG4gICAgICBoZWFkZXJzLFxyXG4gICAgICBib2R5OiBgUHJvamVjdCB3aXRoICR7cHJvamVjdF9pZH0gZG9vZXNuJ3QgZXhpc3RgLFxyXG4gICAgfTtcclxuICB9XHJcbiAgcmV0dXJuIHsgc3RhdHVzQ29kZTogMjAwLCBoZWFkZXJzLCBib2R5OiBKU09OLnN0cmluZ2lmeShwcm9qZWN0KSB9O1xyXG59XHJcblxyXG4vLyBERUxFVEUgcmVxdWVzdCBoYW5kbGVyIGZvciBwcm9qZWN0IHdpdGggaWRcclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvamVjdChwcm9qZWN0X2lkKSB7XHJcbiAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IHByb2plY3RzX2RiLmNvbGxlY3Rpb24oXCJwcm9qZWN0c1wiKTtcclxuICBjb25zdCByZXFib2R5ID0gSlNPTi5wYXJzZShib2R5KTsgLy8gUGFyc2UgSlNPTiBzdHJpbmcgaW50byBhbiBvYmplY3RcclxuICBjb25zdCBxdWVyeSA9IHsgX2lkOiBuZXcgT2JqZWN0SWQocHJvamVjdF9pZCkgfTtcclxuICBjb25zdCBwcm9qZWN0ID0gYXdhaXQgY29sbGVjdGlvbi5kZWxldGVPbmUocXVlcnkpO1xyXG5cclxuICAvKiAgIGNoZWNrIGhvdyBtYW55IHByb2plY3RzIGRlbGV0ZWRcclxuICAgICAgZGVsZXRlZENvdW50IC0+IHByb3BlcnR5IG9mIHRoZSByZXN1bHQgb2JqZWN0IHJldHVybmVkIGJ5IE1vbmdvREJcdTIwMTlzIGRlbGV0ZU9uZSgpIG1ldGhvZC4gIFxyXG4gICAgKi9cclxuICBpZiAocHJvamVjdC5kZWxldGVkQ291bnQgPT09IDApIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcclxuICAgICAgaGVhZGVycyxcclxuICAgICAgYm9keTogYFByb2plY3Qgd2l0aCAke3Byb2plY3RfaWR9IGRvb2Vzbid0IGV4aXN0YCxcclxuICAgIH07XHJcbiAgfVxyXG4gIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgaGVhZGVycywgYm9keTogSlNPTi5zdHJpbmdpZnkocHJvamVjdCkgfTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyAvLyBleHBvcnQgcm91dGVyIG1vZHVsZVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7O0FBQUEsU0FBUyxhQUFhLHdCQUF3QjtBQUM5QyxJQUFNLE1BQU0sUUFBUSxJQUFJLGFBQWE7QUFpQnJDLElBQUksZUFBZTtBQUduQixJQUFNLFNBQVMsSUFBSSxZQUFZLEtBQUs7QUFBQTtBQUFBLEVBRWxDLFdBQVc7QUFBQSxJQUNULFNBQVMsaUJBQWlCO0FBQUE7QUFBQSxJQUMxQixRQUFRO0FBQUE7QUFBQSxJQUNSLG1CQUFtQjtBQUFBO0FBQUEsRUFDckI7QUFDRixDQUFDO0FBRUQsZUFBZSxjQUFjO0FBQzNCLE1BQUk7QUFDRixVQUFNLE9BQU8sUUFBUTtBQUdyQixRQUFJLENBQUMsY0FBYztBQUNqQixxQkFBZTtBQUNmLGNBQVEsSUFBSSw0Q0FBNEM7QUFBQSxJQUMxRDtBQUNBLFdBQU8sYUFBYSxHQUFHLFVBQVU7QUFBQSxFQUNuQyxTQUFTLE9BQU87QUFDZCxZQUFRLE1BQU0s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QztBQUFBLE1BQ0EsTUFBTSxLQUFLLFVBQVUsT0FBTztBQUFBLElBQzlCO0FBQUEsRUFDRixTQUFTLE9BQU87QUFDZCxZQUFRLE1BQU0sNkJBQTZCLEtBQUs7QUFHaEQsV0FBTztBQUFBLE1BQ0wsWUFBWTtBQUFBO0FBQUEsTUFDWixTQUFTO0FBQUEsUUFDUCxnQkFBZ0I7QUFBQSxRQUNoQiwrQkFBK0I7QUFBQSxNQUNqQztBQUFBLE1BQ0EsTUFBTSxLQUFLLFVBQVUsRUFBRSxTQUFTLDJCQUEyQixDQUFDO0FBQUEsSUFDOUQ7QUFBQSxFQUNGO0FBQ0Y7QUFHQSxlQUFlLGNBQWMsWUFBWUEsT0FBTTtBQUM3QyxRQUFNLGFBQWEsTUFBTSxtQkFBWSxXQUFXLFVBQVU7QUFDMUQsUUFBTSxVQUFVLEtBQUssTUFBTUEsS0FBSTtBQUUvQixRQUFNLFFBQVEsRUFBRSxLQUFLLElBQUksU0FBUyxVQUFVLEVBQUU7QUFDOUMsUUFBTSxhQUFhLElBQUksY0FBYyxPQUFPO0FBQzVDLFFBQU0saUJBQWlCLEVBQUUsTUFBTSxXQUFXO0FBQzFDLFFBQU0sVUFBVSxNQUFNLFdBQVcsVUFBVSxPQUFPLGNBQWM7QUFHaEUsTUFBSSxRQUFRLGlCQUFpQixHQUFHO0FBQzlCLFdBQU87QUFBQSxNQUNMLFlBQVk7QUFBQSxNQUNaO0FBQUEsTUFDQSxNQUFNLGdCQUFnQixVQUFVO0FBQUEsSUFDbEM7QUFBQSxFQUNGO0FBQ0EsU0FBTyxFQUFFLFlBQVksS0FBSyxTQUFTLE1BQU0sS0FBSyxVQUFVLE9BQU8sRUFBRTtBQUNuRTtBQUdBLGVBQWUsY0FBYyxZQUFZO0FBQ3ZDLFFBQU0sYUFBYSxNQUFNLG1CQUFZLFdBQVcsVUFBVTtBQUMxRCxRQUFNLFVBQVUsS0FBSyxNQUFNLElBQUk7QUFDL0IsUUFBTSxRQUFRLEVBQUUsS0FBSyxJQUFJLFNBQVMsVUFBVSxFQUFFO0FBQzlDLFFBQU0sVUFBVSxNQUFNLFdBQVcsVUFBVSxLQUFLO0FBS2hELE1BQUksUUFBUSxpQkFBaUIsR0FBRztBQUM5QixXQUFPO0FBQUEsTUFDTCxZQUFZO0FBQUEsTUFDWjtBQUFBLE1BQ0EsTUFBTSxnQkFBZ0IsVUFBVTtBQUFBLElBQ2xDO0FBQUEsRUFDRjtBQUNBLFNBQU8sRUFBRSxZQUFZLEtBQUssU0FBUyxNQUFNLEtBQUssVUFBVSxPQUFPLEVBQUU7QUFDbkU7QUFFQSxJQUFPLGtCQUFROyIsCiAgIm5hbWVzIjogWyJib2R5IiwgImhlYWRlcnMiXQp9Cg==
